#!/bin/bash
set -euo pipefail

BUILD_DIR=$1
CACHE_DIR=$2
DEPS_DIR=$3
DEPS_IDX=$4

echo "Build DIR: $BUILD_DIR"
echo "CACHE_DIR: $CACHE_DIR"
echo "DEPS_DIR: $DEPS_DIR"
echo "DEPS_IDX $DEPS_IDX"

# check if JQ exist?
if ! [ -x "$(command -v jq)" ]; then
  echo "Error: jq is not installed." >&2
  exit 1
fi

# Download JMeter
if [ ! -f $CACHE_DIR/apache-jmeter-5.1.1.tgz ]; then
  echo "Downloading JMeter"
  curl -L https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-5.5.tgz -o $CACHE_DIR/apache-jmeter-5.5.tgz
fi

# Extract JMeter
if [ ! -d $DEPS_DIR/apache-jmeter-5.5 ]; then
  echo "Extracting JMeter"
  tar -xzf $CACHE_DIR/apache-jmeter-5.5.tgz -C $DEPS_DIR
fi
